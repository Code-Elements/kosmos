global.__app_name="kosmos",global.__glob_root=__dirname.replace("/apps/"+__app_name,""),global.__app_root=__dirname;var express=require("express"),bodyParser=require("body-parser"),cookieParser=require("cookie-parser"),session=require("express-session"),app=express();require("dotenv").config();var MongoStore=require("connect-mongo"),i18n=require("i18n");i18n.configure({locales:["ru","en","fr","de"],defaultLocale:"ru",cookie:"locale",directory:__glob_root+"/locales"}),app.set("x-powered-by",!1),app.set("views",__app_root+"/views"),app.set("view engine","pug"),"production"!=process.env.NODE_ENV&&(app.use(express.static(__glob_root+"/public")),app.locals.pretty=!0,app.set("json spaces",2)),app.use(bodyParser.json()),app.use(bodyParser.urlencoded({extended:!0})),app.use(cookieParser()),app.use(i18n.init),app.use(session({key:"session",rolling:!0,resave:!1,saveUninitialized:!1,secret:"keyboard cat",store:MongoStore.create({mongoUrl:"mongodb://localhost/"+__app_name}),cookie:{path:"/",maxAge:432e5}})),app.use((function(req,res,next){res.locals.__app_name=__app_name,res.locals.session=req.session,res.locals.locale=req.cookies.locale||"en",req.locale=req.cookies.locale||"en",res.locals.host=req.hostname,res.locals.url=req.originalUrl,next()}));var admin=require("./routes/admin/_admin.js"),main=require("./routes/main/_main.js"),auth=require("./routes/auth/_auth.js"),error=require("./routes/_error.js");app.use("/",main),app.use("/admin",admin),app.use("/auth",auth),app.use(error.err_500,error.err_404),app.listen(process.env.PORT||3e3,"production"==process.env.NODE_ENV?"localhost":void 0,(function(){console.log("http://localhost:"+(process.env.PORT||3e3))}));